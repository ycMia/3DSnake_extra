#pragma once
#include"pch.h"
#include<iostream>
#include<windows.h>

using namespace std;

class CubeKit
{
public:
	CubeKit()
	{
		hcom = CreateFile(L"COM1", GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING
			, FILE_ATTRIBUTE_NORMAL, NULL);
	}

	~CubeKit()
	{
		CloseHandle(hcom);//用完随手关闭好习惯
	}

	void Check()//填满屏幕(用来照亮,基本用不到)
	{
		printSnake(1);
	}

	void ClearPre()//清除屏幕,慎点
	{
		for (int x = 0; x < 8; ++x)
		{
			for (int z = 0; z < 8; ++z)
			{
				data[x][z] = 0x00;
			}
		}
	}

	void AddPre(int x, int y, int z)
	{
		data[x][z] |= yDefine[y];
	}

	int printSnake(int x = 0)
	{
		if (hcom == INVALID_HANDLE_VALUE)
		{
			return -1;
		}
		SetupComm(hcom, 1024, 1024);
		DCB dcb;
		GetCommState(hcom, &dcb);
		dcb.BaudRate = 57600;
		dcb.ByteSize = 8;
		dcb.Parity = 0;
		dcb.StopBits = 2;
		SetCommState(hcom, &dcb);
		DWORD dwWrittenLen = 0;

		if (x == 0)
		{
			WriteFile(hcom, head, 1, &dwWrittenLen, NULL);
			WriteFile(hcom, data, 64, &dwWrittenLen, NULL);
		}
		else
		{
			unsigned char cdata[8][8] = {
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
			};//底座x&z
			if (!WriteFile(hcom, head, 1, &dwWrittenLen, NULL))
				return -2;
			if (!WriteFile(hcom, cdata, 64, &dwWrittenLen, NULL))
				return -2;
		}
		return 0;
	}
private:
	HANDLE hcom;

	struct Vector3
	{
		int x;
		int y;//高
		int z;
	};
	//Vector3 pre_position[512];
	unsigned const char yDefine[8] = {
		0x01,
		0x02,
		0x04,
		0x08,
		0x10,
		0x20,
		0x40,
		0x80
	};
	unsigned const char head[1] = { 0xF2 };
	unsigned char data[8][8] = {
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
	};//底座x&z

};
#pragma once